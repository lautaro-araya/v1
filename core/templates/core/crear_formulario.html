<!DOCTYPE html>
<html lang="es">
{% load static %}
<head>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="{% static 'core/style_crearformulario.css' %}">
    <title>Formulario de Inspección</title>
</head>
<body style="overflow-x: hidden;">
    <h1>Formulario de Inspección</h1>
    <form method="POST" action="{% url 'crear_formulario' %}">
        {% csrf_token %}
        
        <!-- Datos generales -->
        <h3>Datos Generales</h3>
        
        <label for="encuestador">Encuestador:</label>
        <select id="encuestador" name="encuestador" required>
            {% for encuestador in encuestadores %}
                <option value="{{ encuestador.id }}">{{ encuestador.nombre }} {{ encuestador.apellidos }}</option>
            {% endfor %}
        </select>
        
        <label for="camion">Camión:</label>
        <select id="camion" name="camion" required>
            {% for camion in camiones %}
                <option value="{{ camion.id }}">{{ camion.patente }} - {{ camion.marca }}</option>
            {% endfor %}
        </select>
        
        <label for="ubicacion">Ubicación:</label>
        <input class="ubicacion" type="text" id="ubicacion" name="ubicacion" placeholder="Ubicación" required>
        
        <!-- Componentes por Categoría -->
        {% for categoria, componentes in categorias.items %}
            <h3>{{ categoria }}</h3>
            <table>
                <thead>
                    <tr>
                        <th>Componente</th>
                        <th>Inspección</th>
                        <th>Observaciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for componente in componentes %}
                        <tr>
                            <td>
                                <input type="hidden" name="components[{{ categoria }}][{{ forloop.counter0 }}][componente]" value="{{ componente.id }}">
                                {{ componente.componente }}
                            </td>
                            <td>
                                <select name="components[{{ categoria }}][{{ forloop.counter0 }}][inspeccion]" required>
                                    <option value="B">Bueno</option>
                                    <option value="R">Regular</option>
                                    <option value="M">Malo</option>
                                </select>
                            </td>
                            <td>
                                <input class="observaciones" type="text" name="components[{{ categoria }}][{{ forloop.counter0 }}][observacion]" placeholder="Observaciones">
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% endfor %}
        
        <button type="submit">Guardar Formulario</button>
    </form>
</body>
</html>
<script>
    if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("/static/service-worker.js")
            .then(() => console.log("Service Worker registrado"))
            .catch((err) => console.log("Error al registrar Service Worker:", err));
    }
</script>